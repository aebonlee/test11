# V26.0 풀링 기반 평가 시스템 전체 프로세스

**작성일**: 2026-01-07
**버전**: V26.0 (instructions_v26 구조 반영)
**상태**: 설계 완료

---

## 개요

이 문서는 V26.0 풀링 방식의 전체 프로세스를 정리합니다.
- 작업자 (메인 에이전트, Python, AI)
- 인스트럭션 (누가 누구에게 무엇을 지시하는가)
- 참조 파일 (어떤 파일을 참고하는가)

---

## 핵심 변경사항 (V7.0 구조)

### 새로운 폴더 구조

```
설계문서_V7.0/instructions_v26/
├── README.md                      ← 운영 가이드 (5개씩 배치)
│
├── 1_politicians/                 ← 정치인별 특별 지시사항
│   ├── _TEMPLATE.md
│   ├── 정원오.md
│   ├── 오세훈.md
│   └── 이준석.md
│
├── 2_collect/                     ← 수집 지침서 (10개)
│   ├── cat01_expertise.md
│   ├── cat02_leadership.md
│   ├── cat03_vision.md
│   ├── cat04_integrity.md
│   ├── cat05_ethics.md
│   ├── cat06_accountability.md
│   ├── cat07_transparency.md
│   ├── cat08_communication.md
│   ├── cat09_responsiveness.md
│   └── cat10_publicinterest.md
│
├── 3_evaluate/                    ← 평가 지침서 (10개)
│   ├── cat01_expertise.md
│   ├── cat02_leadership.md
│   ├── cat03_vision.md
│   ├── cat04_integrity.md
│   ├── cat05_ethics.md
│   ├── cat06_accountability.md
│   ├── cat07_transparency.md
│   ├── cat08_communication.md
│   ├── cat09_responsiveness.md
│   └── cat10_publicinterest.md
│
└── V26_풀링_전체프로세스.md       ← 이 문서
```

### 핵심 차이점

| 항목 | 이전 (instructions/) | 현재 (instructions_v26/) |
|------|---------------------|-------------------------|
| 구조 | 수집+평가 통합 | 수집/평가 분리 |
| rating | 수집 시 포함 | 수집 시 없음, 평가 시만 |
| 정치인 정보 | 프롬프트에 하드코딩 | 별도 파일로 분리 |
| 배치 | 10개 동시 | **5개씩 배치** |

---

## 배치 실행 전략 (CRITICAL!)

### 수집 단계: 5개씩 2배치

```
배치 1: cat01~05 (5개 카테고리)
├── cat01_expertise
├── cat02_leadership
├── cat03_vision
├── cat04_integrity
└── cat05_ethics

배치 2: cat06~10 (5개 카테고리)
├── cat06_accountability
├── cat07_transparency
├── cat08_communication
├── cat09_responsiveness
└── cat10_publicinterest
```

### 평가 단계: 5개씩 8배치

```
4 AI × 10 카테고리 = 40개 작업 → 5개씩 8배치

배치 1: Claude cat01~05
배치 2: Claude cat06~10
배치 3: ChatGPT cat01~05
배치 4: ChatGPT cat06~10
배치 5: Grok cat01~05
배치 6: Grok cat06~10
배치 7: Gemini cat01~05
배치 8: Gemini cat06~10
```

### 왜 5개씩?

- 10개 동시 투입 시 시스템 불안정 (터짐)
- 5개씩 배치로 안정성 확보
- 배치 간 적절한 간격 유지

---

## 0단계: 프로세스 시작

### 작업자
**메인 에이전트 (Claude Code)**

### 참조 파일
1. `instructions_v26/README.md` ← 운영 가이드
2. `instructions_v26/1_politicians/{정치인명}.md` ← 대상 정치인 정보
3. `설계문서_V7.0/30명_정치인_명단.md` ← 전체 대상 목록

### 역할
- 전체 프로세스 조율
- Python 스크립트에 인스트럭션 전달
- 진행 상황 모니터링

### 인스트럭션: 메인 에이전트 → Python 스크립트

```bash
# 실행 스크립트: 설계문서_V7.0/실행스크립트/collect_v26_pool.py

python collect_v26_pool.py \
    --politician_id="62e7b453" \
    --politician_name="오세훈" \
    --batch=1  # 배치 1: cat01~05

# 의미: "오세훈에 대해 카테고리 1~5 수집 시작 (rating 없이)"
```

---

## 1단계: 수집 (rating 없이)

### 작업자
**Python 스크립트 (collect_v26_pool.py)**

### 참조 파일

1. **정치인 정보**
   ```
   instructions_v26/1_politicians/오세훈.md
   ```
   - 9개 필드: 성명, 현 직책, 소속 정당, 출마 신분, 출마 직종, 지역, 지역구, 성별, 나이
   - 특별 지시사항

2. **수집 지침서** (해당 카테고리)
   ```
   instructions_v26/2_collect/cat01_expertise.md
   instructions_v26/2_collect/cat02_leadership.md
   ...
   ```
   - 카테고리 정의
   - 평가 범위 ([O] 해당, [X] 비해당)
   - OFFICIAL/PUBLIC 출처
   - 검색 키워드
   - 수집 구조 (50개)
   - 주의사항

### 인스트럭션: Python → 수집 AI

**프롬프트 구성**:
1. 정치인 정보 (1_politicians/*.md에서)
2. 카테고리 수집 지침 (2_collect/cat*.md에서)
3. 기간 제한 규칙

```
"""
당신은 정치인 평가 데이터 수집 AI입니다.

**대상 정치인**:
- politician_id: 62e7b453
- 성명: 오세훈
- 현 직책: 서울특별시장
- 소속 정당: 국민의힘
- 출마 신분: 출마예정자
- 출마 직종: 광역단체장
- 지역: 서울특별시
- 지역구: 서울시 전체
- 성별: 남
- 나이: 64세

**특별 지시사항**:
- 2021년 보궐선거 당선 이후 데이터 중심
- 서울시 주요 정책 (재개발, 교통, 도시계획) 주목

⚠️ V26.0 기간 제한:
- OFFICIAL: 2022-01-07 ~ 2026-01-07 (최근 4년)
- PUBLIC: 2025-01-07 ~ 2026-01-07 (최근 1년)

**카테고리**: 전문성 (Expertise)
[2_collect/cat01_expertise.md의 내용 삽입]

**수집 개수**: 50개
- OFFICIAL 25개 (4년 이내)
- PUBLIC 25개 (1년 이내)
- 부정 주제 최소 10개 (20%)

⚠️ rating 없이 데이터만 수집하세요!

다음 JSON 형식으로 반환:
{
  "items": [
    {
      "item_num": 1,
      "data_title": "제목 (20자 이내)",
      "data_content": "내용 (100-300자)",
      "data_source": "출처명",
      "source_url": "https://...",
      "source_type": "OFFICIAL",
      "data_date": "2025-06-15"
    }
  ]
}
"""
```

### 결과
- 4개 AI × 10개 카테고리 × 50개 = 2,000개 수집 (rating 없음)

---

## 2단계: DB 저장 (rating NULL)

### 작업자
**Python 스크립트 (collect_v26_pool.py)**

### 참조 파일
- `설계문서_V7.0/Database/DB_SCHEMA.md`

### 코드
```python
for item in response['items']:
    supabase.table('collected_data_v26').insert({
        'politician_id': '62e7b453',
        'collected_by': 'Claude',
        'category_name': 'Expertise',
        'data_title': item['data_title'],
        'data_content': item['data_content'],
        'data_source': item['data_source'],
        'source_url': item['source_url'],
        'source_type': item['source_type'],
        'data_date': item['data_date'],
        'rating': None  # NULL!
    })
```

---

## 3단계: 풀 완성 확인

### 인스트럭션: 메인 에이전트 → Python 스크립트

```bash
python evaluate_v26_pool.py \
    --politician_id="62e7b453" \
    --batch=1  # 배치 1: Claude cat01~05

# 의미: "풀 확인하고, 배치 1 평가 시작"
```

### 코드
```python
result = supabase.table('collected_data_v26') \
         .select('id', count='exact') \
         .eq('politician_id', '62e7b453') \
         .eq('category_name', 'Expertise') \
         .execute()

if result.count == 200:
    print("✅ 풀 완성! 평가 진행")
else:
    print(f"❌ 풀 미완성: {result.count}/200")
```

---

## 4단계: 평가 (타이밍 분리 = 객관성)

### 작업자
**Python 스크립트 (evaluate_v26_pool.py)**

### 참조 파일

1. **정치인 정보**
   ```
   instructions_v26/1_politicians/오세훈.md
   ```

2. **평가 지침서** (해당 카테고리)
   ```
   instructions_v26/3_evaluate/cat01_expertise.md
   ```
   - 카테고리 정의
   - 등급 체계 (A~H)
   - 등급 판단 세부 기준
   - 주의사항

### 인스트럭션: Python → 평가 AI

**프롬프트 구성**:
1. 정치인 정보 (1_politicians/*.md에서)
2. 카테고리 평가 지침 (3_evaluate/cat*.md에서)
3. 평가 대상 데이터 (DB에서 조회한 200개)

```
"""
당신은 정치인 평가 AI입니다.

**대상 정치인**: 오세훈 (서울시장, 국민의힘)
**평가 카테고리**: 전문성 (Expertise)

[3_evaluate/cat01_expertise.md의 내용 삽입]

**등급 체계** (8단계):
| 등급 | 판단 기준 |
|------|-----------|
| A | 탁월함 |
| B | 우수함 |
| C | 양호함 |
| D | 보통 |
| E | 미흡함 |
| F | 부족함 |
| G | 매우 부족 |
| H | 극히 부족 |

**평가 대상 데이터** (200개):
[DB에서 조회한 데이터 삽입]

다음 JSON 형식으로 반환:
{
  "ratings": [
    {"data_id": 1, "rating": "B", "rationale": "평가 근거"},
    {"data_id": 2, "rating": "C", "rationale": "평가 근거"},
    ...
  ]
}
"""
```

### 핵심: 타이밍 분리 = 객관성

```
수집 시점의 Claude (세션 1) ≠ 평가 시점의 Claude (세션 2)

- 새로운 API 호출 = 새로운 세션
- 이전 수집 기억 없음
- 독립적으로 판단
- 더 객관적!
```

---

## 5단계: 평가 결과 저장

### 코드
```python
for ai_name in ['Claude', 'ChatGPT', 'Grok', 'Gemini']:
    for rating_item in response[ai_name]['ratings']:
        supabase.table('ai_ratings_v26').insert({
            'data_id': rating_item['data_id'],
            'evaluated_by': ai_name,
            'rating': rating_item['rating'],
            'rating_rationale': rating_item['rationale']
        })
```

---

## 6단계: 점수 계산

### 작업자
**Python 스크립트 (calculate_v26_pool_scores.py)**

**※ AI 호출 없음! Python이 직접 계산**

### 참조 파일
- `설계문서_V7.0/V24_점수계산_알고리즘_상세가이드.md`

### Step 6-1: 알파벳 → 숫자 변환

```python
ALPHABET_TO_NUMERIC = {
    'A': 8, 'B': 6, 'C': 4, 'D': 2,
    'E': -2, 'F': -4, 'G': -6, 'H': -8
}
```

### Step 6-2: 카테고리별 평균 및 점수 계산

```python
avg_rating = sum(numeric_ratings) / len(numeric_ratings)

PRIOR = 6.0
COEFFICIENT = 0.5
category_score = (PRIOR + avg_rating * COEFFICIENT) * 10
# 결과: 20~100점 범위
```

### Step 6-3: 최종 점수 합산

```python
total_score = sum(category_scores)  # 10개 카테고리 합산
final_score = round(min(total_score, 1000))
# 결과: 200~1000점 범위
```

---

## 7단계: 등급 산출

### 참조 파일
- `설계문서_V7.0/등급체계_10단계_200-1000점_V24.md`

### 코드
```python
def get_grade(score):
    if score >= 920: return "M", "Mugunghwa (최우수)"
    elif score >= 840: return "D", "Diamond (우수)"
    elif score >= 760: return "E", "Emerald (양호)"
    elif score >= 680: return "P", "Platinum (보통+)"
    elif score >= 600: return "G", "Gold (보통)"
    elif score >= 520: return "S", "Silver (보통-)"
    elif score >= 440: return "B", "Bronze (미흡)"
    elif score >= 360: return "I", "Iron (부족)"
    elif score >= 280: return "Tn", "Tin (상당히 부족)"
    else: return "L", "Lead (매우 부족)"
```

---

## 8단계: 결과 저장 및 보고

### 코드
```python
supabase.table('ai_evaluations_v26').upsert({
    'politician_id': '62e7b453',
    'total_score': 744,
    'grade_code': 'P',
    'ai_count': 4
})

print("✅ 점수 계산 완료: 744점 (P등급)")
```

---

## 실행 스크립트 요약

| 스크립트 | 역할 | 배치 |
|---------|------|------|
| collect_v26_pool.py | 수집 (rating 없이) | 5개씩 2배치 |
| evaluate_v26_pool.py | 평가 (200개 풀 전체) | 5개씩 8배치 |
| calculate_v26_pool_scores.py | 점수 계산 | 배치 없음 |

### 실행 명령어 (배치별)

```bash
# ===== 수집 단계 (2배치) =====

# 배치 1: 카테고리 1~5
python collect_v26_pool.py --politician_id=62e7b453 --politician_name="오세훈" --categories=1,2,3,4,5

# 배치 2: 카테고리 6~10
python collect_v26_pool.py --politician_id=62e7b453 --politician_name="오세훈" --categories=6,7,8,9,10


# ===== 평가 단계 (8배치) =====

# 배치 1: Claude cat01~05
python evaluate_v26_pool.py --politician_id=62e7b453 --ai=Claude --categories=1,2,3,4,5

# 배치 2: Claude cat06~10
python evaluate_v26_pool.py --politician_id=62e7b453 --ai=Claude --categories=6,7,8,9,10

# 배치 3~8: ChatGPT, Grok, Gemini 동일 패턴
...


# ===== 점수 계산 =====
python calculate_v26_pool_scores.py --politician_id=62e7b453
```

---

## 비용 추정

### 정치인 1명당

| 단계 | 토큰 | 비용 |
|------|------|------|
| 수집 (4 AI × 10 cat) | ~400K | ~$1.20 |
| 평가 (4 AI × 10 cat) | ~500K | ~$1.50 |
| **합계** | ~900K | **~$2.70** |

### 30명 전체

- 약 $81 (30명 × $2.70)

---

## 핵심 포인트

### 1. 수집과 평가 분리 (타이밍 분리)
- 같은 AI도 다른 세션 = 독립 판단 = 객관성

### 2. 지침서 분리 (2_collect vs 3_evaluate)
- 수집: rating 없음, 50개 수집
- 평가: rating 있음, 200개 평가

### 3. 정치인 정보 분리 (1_politicians)
- 9개 필드 + 특별 지시사항
- 프롬프트에서 참조

### 4. 5개씩 배치 실행
- 10개 동시 → 시스템 불안정
- 5개씩 → 안정적 실행

### 5. 자연 가중치
- 중복 수집된 데이터 = 더 많이 평가됨 = 자동 가중치

---

## 예상 소요 시간

| 단계 | 순차 | 배치(5개씩) |
|------|------|------------|
| 수집 (2배치) | 20분 | 10분 |
| 평가 (8배치) | 80분 | 40분 |
| 점수계산 | 1분 | 1분 |
| **합계** | 101분 | **51분** |

---

**최종 업데이트**: 2026-01-07
**버전**: V26.0 (instructions_v26 구조)
