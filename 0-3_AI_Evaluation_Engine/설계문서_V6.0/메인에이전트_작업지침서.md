# ë©”ì¸ ì—ì´ì „íŠ¸ ì‘ì—… ì§€ì¹¨ì„œ

**ì‘ì„±ì¼**: 2025-11-19
**ëŒ€ìƒ**: Claude Code ë©”ì¸ ì—ì´ì „íŠ¸
**ëª©ì **: ë°˜ë³µë˜ëŠ” ì˜¤ë¥˜ ë°©ì§€ ë° ì‘ì—… íš¨ìœ¨ì„± í–¥ìƒ

---

## ğŸš¨ ìµœìš°ì„  í™•ì¸ì‚¬í•­ - DB ìŠ¤í‚¤ë§ˆ

### collected_data í…Œì´ë¸” Primary Key
```
collected_data_id
```

### âš ï¸ ì ˆëŒ€ ê¸ˆì§€ - ì´ ì˜¤ë¥˜ë¥¼ ë‹¤ì‹œëŠ” ë°˜ë³µí•˜ì§€ ë§ˆì„¸ìš”!

**ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ë“¤**:
- âŒ `id` - ì´ ì»¬ëŸ¼ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- âŒ `item_id` - ì´ ì»¬ëŸ¼ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤

**ë°˜ë“œì‹œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì»¬ëŸ¼**:
- âœ… `collected_data_id` - ì´ê²ƒë§Œ Primary Keyë¡œ ì‚¬ìš©

### ì‘ì—… ì „ í•„ìˆ˜ ìŠ¤í‚¤ë§ˆ í™•ì¸

ìƒˆë¡œìš´ DB ì‘ì—… ì „ì—ëŠ” **ë°˜ë“œì‹œ** ë¨¼ì € ìŠ¤í‚¤ë§ˆë¥¼ í™•ì¸í•˜ì„¸ìš”:

```python
from supabase import create_client
from dotenv import load_dotenv
import os

load_dotenv()
supabase = create_client(
    os.getenv('SUPABASE_URL'),
    os.getenv('SUPABASE_SERVICE_ROLE_KEY')
)

# ìŠ¤í‚¤ë§ˆ í™•ì¸
result = supabase.table('collected_data').select('*').limit(1).execute()
print(list(result.data[0].keys()) if result.data else 'No data')
```

**ì¶œë ¥ ê²°ê³¼**:
```python
[
    'collected_data_id',  # âœ… PRIMARY KEY
    'politician_id',
    'ai_name',
    'category_name',
    'item_num',
    'data_title',
    'data_content',
    'data_source',
    'source_url',
    'collection_date',
    'rating',
    'rating_rationale',
    'source_type'
]
```

---

## âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ ì‘ì„± ì˜ˆì‹œ

### SELECT ì¿¼ë¦¬
```python
# âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
result = supabase.table('collected_data')\
    .select('collected_data_id, item_num, rating')\
    .eq('politician_id', '5')\
    .execute()

# âŒ ì˜ëª»ëœ ì˜ˆì‹œ - ì—ëŸ¬ ë°œìƒ!
result = supabase.table('collected_data')\
    .select('id, item_num')\  # ì—ëŸ¬: column "id" does not exist
    .execute()
```

### DELETE ì‘ì—…
```python
# âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
for item in items_to_delete:
    delete_id = item['collected_data_id']
    supabase.table('collected_data')\
        .delete()\
        .eq('collected_data_id', delete_id)\
        .execute()

# âŒ ì˜ëª»ëœ ì˜ˆì‹œ - ì—ëŸ¬ ë°œìƒ!
supabase.table('collected_data')\
    .delete()\
    .eq('id', delete_id)\  # ì—ëŸ¬: column "id" does not exist
    .execute()
```

### UPDATE ì‘ì—…
```python
# âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
supabase.table('collected_data')\
    .update({'rating': new_rating})\
    .eq('collected_data_id', target_id)\
    .execute()

# âŒ ì˜ëª»ëœ ì˜ˆì‹œ
supabase.table('collected_data')\
    .update({'rating': new_rating})\
    .eq('item_id', target_id)\  # ì—ëŸ¬: column "item_id" does not exist
    .execute()
```

---

## ğŸ“‹ ì½”ë”© ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒˆë¡œìš´ Python ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ì‹œ

- [ ] 1. DB ìŠ¤í‚¤ë§ˆ í™•ì¸ ì½”ë“œë¥¼ ì£¼ì„ìœ¼ë¡œ í¬í•¨í–ˆëŠ”ê°€?
- [ ] 2. Primary Keyë¡œ `collected_data_id` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] 3. `id`, `item_id` ì‚¬ìš©í•˜ì§€ ì•Šì•˜ëŠ”ê°€?
- [ ] 4. UTF-8 ì¸ì½”ë”© ì„¤ì • í¬í•¨í–ˆëŠ”ê°€?
- [ ] 5. .env íŒŒì¼ ë¡œë“œ ì½”ë“œ í¬í•¨í–ˆëŠ”ê°€?

### DB ì¿¼ë¦¬ ì‘ì„± ì‹œ

- [ ] 1. SELECT ë¬¸ì—ì„œ `collected_data_id` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] 2. DELETE ë¬¸ì—ì„œ `.eq('collected_data_id', ...)` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] 3. UPDATE ë¬¸ì—ì„œ `.eq('collected_data_id', ...)` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] 4. `id`ë‚˜ `item_id` ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ëŠ”ê°€?

---

## ğŸ”§ í‘œì¤€ ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿

### ê¸°ë³¸ Python ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿

```python
# -*- coding: utf-8 -*-
"""
ìŠ¤í¬ë¦½íŠ¸ ì„¤ëª…
"""
import os
import sys
from supabase import create_client
from dotenv import load_dotenv

# UTF-8 ì¶œë ¥ ì„¤ì • (Windows)
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

load_dotenv()

# Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
supabase = create_client(
    os.getenv('SUPABASE_URL'),
    os.getenv('SUPABASE_SERVICE_ROLE_KEY')
)

# DB ìŠ¤í‚¤ë§ˆ ì°¸ì¡°:
# Primary Key: collected_data_id
# ì»¬ëŸ¼: politician_id, ai_name, category_name, item_num,
#       data_title, data_content, rating, data_source, etc.

def main():
    # ë©”ì¸ ë¡œì§
    pass

if __name__ == "__main__":
    main()
```

---

## ğŸ“š ì°¸ì¡° ë¬¸ì„œ

### í•„ìˆ˜ ì°¸ì¡°
1. **CLAUDE.md** - ì „ì²´ í”„ë¡œì íŠ¸ ì‘ì—… ì§€ì¹¨
2. **Database/DB_SCHEMA.md** - ìƒì„¸ DB ìŠ¤í‚¤ë§ˆ ì •ë³´
3. **ì„¤ê³„ë¬¸ì„œ_V5.0/** - ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ

### í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœ
- **ì•Œê³ ë¦¬ì¦˜**: Prior 6.5, Coefficient 0.5
- **ë“±ê¸‰ ì‹œìŠ¤í…œ**: A, B, C, D, -D, -C, -B, -A (8ë‹¨ê³„)
- **Rating ë²”ìœ„**: A~-A (8ë‹¨ê³„ ì•ŒíŒŒë²³)
- **AI ëª¨ë¸**: claude-3-5-haiku-20241022
- **ì¹´í…Œê³ ë¦¬ë‹¹ ëª©í‘œ**: 50ê°œ í•­ëª©

---

## ğŸš« ê³¼ê±° ì˜¤ë¥˜ ì‚¬ë¡€ - ì ˆëŒ€ ë°˜ë³µ ê¸ˆì§€

### ì‚¬ë¡€ 1: `id` ì»¬ëŸ¼ ì‚¬ìš©
```python
# âŒ ë°œìƒí•œ ì˜¤ë¥˜
result = supabase.table('collected_data').select('id, item_num')
# ì—ëŸ¬: column collected_data.id does not exist

# âœ… ìˆ˜ì •
result = supabase.table('collected_data').select('collected_data_id, item_num')
```

### ì‚¬ë¡€ 2: `item_id` ì»¬ëŸ¼ ì‚¬ìš©
```python
# âŒ ë°œìƒí•œ ì˜¤ë¥˜
delete_ids = [item['item_id'] for item in to_delete]
# ì—ëŸ¬: KeyError 'item_id'

# âœ… ìˆ˜ì •
delete_ids = [item['collected_data_id'] for item in to_delete]
```

### ì‚¬ë¡€ 3: DELETE ì‘ì—… ì‹œ ì˜ëª»ëœ ì»¬ëŸ¼
```python
# âŒ ë°œìƒí•œ ì˜¤ë¥˜
supabase.table('collected_data').delete().eq('id', delete_id)
# ì—ëŸ¬: column "id" does not exist

# âœ… ìˆ˜ì •
supabase.table('collected_data').delete().eq('collected_data_id', delete_id)
```

---

## ğŸ’¡ ì‘ì—… ì‹œ ê¶Œì¥ì‚¬í•­

### 1. ì½”ë“œ ì‘ì„± ì „
- DB ìŠ¤í‚¤ë§ˆ í™•ì¸ ëª…ë ¹ì–´ ì‹¤í–‰
- `Database/DB_SCHEMA.md` íŒŒì¼ í™•ì¸
- ì´ ì§€ì¹¨ì„œ ì¬í™•ì¸

### 2. ì½”ë“œ ì‘ì„± ì¤‘
- Primary KeyëŠ” í•­ìƒ `collected_data_id`
- ë³€ìˆ˜ëª…ë„ ëª…í™•í•˜ê²Œ: `collected_data_id`, `data_id` ë“±
- `id`ë‚˜ `item_id` ê°™ì€ ëª¨í˜¸í•œ ì´ë¦„ ì‚¬ìš© ê¸ˆì§€

### 3. ì½”ë“œ ì‘ì„± í›„
- ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸
- ëª¨ë“  DB ì¿¼ë¦¬ì—ì„œ `collected_data_id` ì‚¬ìš© ì—¬ë¶€ ì¬í™•ì¸
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ í•œ ë²ˆ ë” í™•ì¸

---

## ğŸ“ ë¬¸ì œ ë°œìƒ ì‹œ

### Column does not exist ì—ëŸ¬ ë°œìƒ ì‹œ

1. **ì¦‰ì‹œ ì¤‘ë‹¨**: ë” ì´ìƒ ì§„í–‰í•˜ì§€ ë§ê³  ë©ˆì¶”ê¸°
2. **ìŠ¤í‚¤ë§ˆ í™•ì¸**: ìœ„ì˜ ìŠ¤í‚¤ë§ˆ í™•ì¸ ì½”ë“œ ì‹¤í–‰
3. **ì´ ë¬¸ì„œ í™•ì¸**: Primary Key ì„¹ì…˜ ì¬í™•ì¸
4. **ì½”ë“œ ìˆ˜ì •**: `collected_data_id`ë¡œ ë³€ê²½
5. **ì¬í…ŒìŠ¤íŠ¸**: ìˆ˜ì • í›„ ë‹¤ì‹œ ì‹¤í–‰

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-19
**ë²„ì „**: 1.0
**ì‘ì„±ì**: Claude Code

**ì´ ë¬¸ì„œë¥¼ ì‘ì—… ì‹œì‘ ì „ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”!**
