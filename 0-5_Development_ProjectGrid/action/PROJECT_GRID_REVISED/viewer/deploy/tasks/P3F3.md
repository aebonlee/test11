# P3F3: status 필드 제거 및 identity/title 분리 작업

## 작업 개요
정치인 데이터의 `status` 필드(신분/직책 결합)를 완전히 제거하고, `identity`(신분)와 `title`(직책)을 독립적인 필드로 분리하여 사용하도록 전체 시스템 수정

## 작업 배경 및 필요성

### 문제점
현재 `status` 필드에 "현직 국회의원 (21대)"처럼 신분과 직책을 결합하여 저장하면:
- **신분 변경 불가**: 현직 → 후보자로 변경 시 직책도 함께 변경해야 함
- **직책 변경 불가**: 국회의원 → 구청장으로 변경 시 신분도 함께 변경해야 함
- **데이터 일관성 문제**: "현직 국회의원"에서 "후보자 구청장"으로 변경 시 파싱 오류 가능
- **검색/필터링 어려움**: 신분별 또는 직책별 필터링이 불가능

### 해결 방안
- `identity` 필드: 신분만 저장 (현직, 후보자, 예비후보자, 출마자)
- `title` 필드: 직책만 저장 (국회의원 (21대), 서울시의원 등)
- `status` 필드: 완전히 제거 (하위 호환성 포기)

## 작업 범위

### 1. 데이터베이스 수정
- [x] `identity` 컬럼 추가 (VARCHAR(50))
- [x] `title` 컬럼 추가 (VARCHAR(200))
- [ ] 기존 데이터 마이그레이션: `status` 값을 파싱하여 `identity`와 `title`로 분리
- [ ] `status` 컬럼 삭제 (마이그레이션 완료 후)

### 2. API 수정
**백엔드 API (5개 파일)**:
- [ ] `1_Frontend/src/app/api/politicians/route.ts` - GET 목록 조회
- [ ] `1_Frontend/src/app/api/politicians/[id]/route.ts` - GET 상세 조회
- [x] `1_Frontend/src/app/api/admin/politicians/route.ts` - POST 추가 (이미 수정됨)
- [ ] `1_Frontend/src/app/api/admin/content/route.ts` - GET 관리자 목록
- [ ] 기타 정치인 관련 API 엔드포인트

**수정 내용**:
- Response에서 `status` 필드 제거
- `identity`와 `title` 필드 추가
- 기존 데이터 조회 시 `status` 파싱 로직 (과도기적 처리)

### 3. Frontend 컴포넌트 수정
**정치인 상세 페이지 (1개 파일)**:
- [ ] `1_Frontend/src/app/politicians/[id]/page.tsx`
  - Interface 수정: `status` → `identity`, `title`
  - UI 표시: "신분/직책" → "신분", "직책" (별도 행)
  - Sample data 수정

**정치인 목록 페이지 (1개 파일)**:
- [ ] `1_Frontend/src/app/politicians/page.tsx`
  - Interface 수정
  - 테이블/카드 UI에서 신분, 직책 별도 표시
  - Sample data 수정

**기타 페이지 (3개 파일)**:
- [ ] `1_Frontend/src/app/page.tsx` - 홈 화면
- [ ] `1_Frontend/src/app/search/search-content.tsx` - 검색 결과
- [ ] `1_Frontend/src/app/favorites/page.tsx` - 즐겨찾기

### 4. 관리자 페이지 수정
- [x] `1_Frontend/src/app/admin/politicians/page.tsx` - 목록 및 추가 (이미 수정됨)
- [ ] 관리자 게시글 관리 페이지에서 정치인 정보 표시 부분

### 5. TypeScript 타입 정의
- [ ] 공통 타입 파일 생성: `types/politician.ts`
  ```typescript
  export interface Politician {
    id: string;
    name: string;
    identity: string;      // 신분
    title?: string;        // 직책 (선택)
    position: string;      // 출마직종
    party: string;
    region: string;
    // ... 기타 필드
  }
  ```

## 작업 순서

### Phase 1: 데이터 마이그레이션 (우선순위: 최상)
1. 기존 `status` 데이터 분석
   - 패턴 파악: "현직 국회의원 (21대)", "후보자", "예비후보자" 등
   - 파싱 규칙 수립
2. 마이그레이션 스크립트 작성
   ```sql
   -- 예시: status를 파싱하여 identity와 title로 분리
   UPDATE politicians
   SET
     identity = CASE
       WHEN status LIKE '현직%' THEN '현직'
       WHEN status LIKE '후보자%' THEN '후보자'
       WHEN status LIKE '예비후보자%' THEN '예비후보자'
       ELSE '출마자'
     END,
     title = CASE
       WHEN status LIKE '%국회의원%' THEN TRIM(SUBSTRING(status FROM POSITION('국회의원' IN status)))
       WHEN status LIKE '%시의원%' THEN TRIM(SUBSTRING(status FROM POSITION('시의원' IN status)))
       ELSE NULL
     END;
   ```
3. 마이그레이션 실행 및 검증
4. 백업 생성

### Phase 2: Backend API 수정 (우선순위: 상)
1. GET /api/politicians - 목록 조회 API 수정
2. GET /api/politicians/[id] - 상세 조회 API 수정
3. GET /api/admin/content - 관리자 콘텐츠 API 수정
4. 모든 API Response 검증

### Phase 3: Frontend 수정 (우선순위: 상)
1. 공통 타입 정의 파일 생성
2. 정치인 상세 페이지 수정
3. 정치인 목록 페이지 수정
4. 홈 화면 수정
5. 검색 결과 페이지 수정
6. 즐겨찾기 페이지 수정

### Phase 4: 테스트 및 검증 (우선순위: 상)
1. 단위 테스트
   - API Response 형식 검증
   - 데이터 파싱 로직 테스트
2. 통합 테스트
   - 정치인 목록 조회
   - 정치인 상세 조회
   - 정치인 추가 (관리자)
3. UI 테스트
   - 모든 페이지에서 신분/직책 표시 확인
   - 모바일/데스크톱 레이아웃 확인

### Phase 5: 배포 및 정리 (우선순위: 중)
1. Vercel 배포
2. 프로덕션 데이터베이스 마이그레이션
3. 모니터링
4. `status` 컬럼 삭제 (안정화 후)

## 예상 소요 시간
- Phase 1 (데이터 마이그레이션): 2시간
- Phase 2 (Backend API 수정): 1.5시간
- Phase 3 (Frontend 수정): 2.5시간
- Phase 4 (테스트 및 검증): 1.5시간
- Phase 5 (배포 및 정리): 0.5시간
- **총 예상 시간**: 8시간

## 위험 요소 및 대응 방안

### 위험 1: 데이터 파싱 오류
- **위험도**: 상
- **대응**: 마이그레이션 전 샘플 데이터로 충분한 테스트
- **Rollback 계획**: status 컬럼 유지 (백업 용도)

### 위험 2: 기존 API 의존성
- **위험도**: 중
- **대응**: API Response에서 `status` 필드를 당분간 유지 (deprecated 표시)
- **Rollback 계획**: 단계적 제거 (Phase별로 진행)

### 위험 3: UI 레이아웃 변경
- **위험도**: 하
- **대응**: 신분과 직책을 별도 행으로 표시하여 레이아웃 영향 최소화

## 성공 기준
1. ✅ 모든 정치인 데이터가 `identity`와 `title`로 정확히 분리됨
2. ✅ 모든 페이지에서 신분과 직책이 독립적으로 표시됨
3. ✅ 정치인 신분 변경 시 직책 유지됨
4. ✅ 정치인 직책 변경 시 신분 유지됨
5. ✅ 빌드 에러 없음
6. ✅ TypeScript 타입 에러 없음
7. ✅ 모든 테스트 통과

## 관련 파일 목록
- Database: `politicians` 테이블
- API (5개): politicians/route.ts, politicians/[id]/route.ts, admin/politicians/route.ts, admin/content/route.ts
- Frontend (6개): politicians/[id]/page.tsx, politicians/page.tsx, page.tsx, search/search-content.tsx, favorites/page.tsx, admin/politicians/page.tsx
- Types (1개): types/politician.ts (신규 생성)

## 의존성
- **선행 작업**: P3F2 (새 정치인 추가 기능) - 완료됨
- **후속 작업**: P4BA20 (정치인 데이터 자동 수집)

## 비고
- 이 작업은 **데이터 구조의 근본적인 개선**이므로 신중하게 진행
- 단계별로 커밋하여 Rollback 가능하도록 함
- 배포 후 최소 1주일간 `status` 컬럼 유지 (안전장치)
