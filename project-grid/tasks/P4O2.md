# 작업지시서: P4O2

## 📋 기본 정보

- **작업 ID**: P4O2
- **업무명**: 인기 게시글 집계 스케줄러
- **Phase**: Phase 4
- **Area**: Operations (O)
- **서브 에이전트**: devops-engineer
- **작업 방식**: AI-Only

---

## 🎯 작업 목표

인기 게시글 순위 자동 계산 (Cron)

---

## 🔧 사용 도구

```
[Claude 도구]
Read, Edit, Write, Grep, Glob, Bash

[기술 스택]
GitHub Actions, Vercel, Sentry

[전문 스킬]
ci-cd, deployment
```

**도구 설명**:
- **Claude 도구**: Claude Code의 기본 기능 (Read, Write, Edit, Bash, Glob, Grep 등)
- **기술 스택**: 프로젝트에 사용되는 프레임워크 및 라이브러리
- **전문 스킬**: Anthropic 빌트인 스킬 (.claude/skills/*.md 참조)

## 🔗 의존성 정보

**의존성 체인**: P2D1

이 작업을 시작하기 전에 다음 작업이 완료되어야 합니다: P2D1

---

## 📦 기대 결과물

**생성할 파일:**
1. `app/api/cron/aggregate-trending/route.ts` - Cron API Route
2. `vercel.json` - Cron 스케줄 추가 (기존 파일 업데이트)

**Cron 스케줄:**
- 매시간 정각 실행: `0 * * * *`

**vercel.json 추가:**
```json
{
  "crons": [
    {
      "path": "/api/cron/update-politicians",
      "schedule": "0 6 * * *"
    },
    {
      "path": "/api/cron/aggregate-trending",
      "schedule": "0 * * * *"
    }
  ]
}
```

**인기 점수 계산 공식:**
```
score = (like_count * 3) + (comment_count * 5) + (view_count * 0.1) - (age_in_hours * 2)
```

**집계 기간:** 최근 7일 이내 게시글

**구현해야 할 세부 항목**:

1. Vercel Cron Job 설정 (매시간 정각)
2. API Route 생성 (cron 인증 헤더 검증)
3. 공감/댓글/조회수 집계 (최근 7일)
4. 인기 순위 계산 (점수 공식 적용)
5. 결과 저장 (캐시 테이블 또는 Redis)
6. 상위 100개 게시글만 저장

각 항목을 체계적으로 구현하고 테스트하세요.

---

## 💾 구현 파일 저장 위치

**루트 폴더**: `3_Backend_APIs/`

**파일 경로**:
```
3_Backend_APIs/
└── app/
    └── api/
        └── cron/
            └── aggregate-trending/
                └── route.ts
```

**절대 경로 별칭**: `@/` (예: `import ... from '@/app/api/cron/aggregate-trending/route'`)

---

## 📝 작업 지시사항

### 1. 준비 단계

- 프로젝트 루트 디렉토리에서 작업 시작
- 필요한 도구 확인: GitHub Actions/Vercel/Sentry
- 의존성 작업 완료 확인 (P2D1)

### 2. 구현 단계

**구현해야 할 세부 항목**:

1. Vercel Cron Job 설정
2. API Route 생성
3. 공감/댓글/조회수 집계
4. 인기 순위 계산
5. 결과 저장 (캐시 테이블)

각 항목을 체계적으로 구현하고 테스트하세요.

### 3. 검증 단계

- 작성한 코드의 정상 동작 확인
- 타입 체크 및 린트 통과
- 필요한 경우 단위 테스트 작성
- 코드 리뷰 준비

### 4. 완료 단계

- 생성된 파일 목록 확인
- PROJECT GRID 상태 업데이트
- 다음 의존 작업에 영향 확인

---

## ✅ 완료 기준

- [ ] 인기 게시글 집계 스케줄러 기능이 정상적으로 구현됨
- [ ] 기대 결과물이 모두 생성됨
- [ ] 코드가 정상적으로 빌드/실행됨
- [ ] 타입 체크 및 린트 통과
- [ ] PROJECT GRID 상태 업데이트 완료

---

**작업지시서 생성일**: 2025-11-06
**PROJECT GRID Version**: v4.0
