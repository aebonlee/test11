# ì‘ì—…ì§€ì‹œì„œ: P3BA12

## ğŸ“‹ ê¸°ë³¸ ì •ë³´

- **ì‘ì—… ID**: P3BA12
- **ì—…ë¬´ëª…**: AI í‰ê°€ ìƒì„± API (Mock â†’ Real)
- **Phase**: Phase 3
- **Area**: Backend APIs (BA)
- **ì„œë¸Œ ì—ì´ì „íŠ¸**: backend-developer
- **ì‘ì—… ë°©ì‹**: AI-Only

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

Mock APIë¥¼ Supabase ì—°ë™ Real APIë¡œ ì „í™˜í•˜ì—¬ ì‹¤ì œ AI í‰ê°€ ë°ì´í„° ìƒì„±/ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ êµ¬í˜„

---

## ğŸ”§ ì‚¬ìš© ë„êµ¬

```
[Claude ë„êµ¬]
Read, Edit, Write, Grep, Glob, Bash

[ê¸°ìˆ  ìŠ¤íƒ]
TypeScript, Next.js API Routes, Supabase, Zod

[ì „ë¬¸ ìŠ¤í‚¬]
api-builder, api-test
```

**ë„êµ¬ ì„¤ëª…**:
- **Claude ë„êµ¬**: Claude Codeì˜ ê¸°ë³¸ ê¸°ëŠ¥ (Read, Write, Edit, Bash, Glob, Grep ë“±)
- **ê¸°ìˆ  ìŠ¤íƒ**: í”„ë¡œì íŠ¸ì— ì‚¬ìš©ë˜ëŠ” í”„ë ˆì„ì›Œí¬ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
- **ì „ë¬¸ ìŠ¤í‚¬**: Anthropic ë¹ŒíŠ¸ì¸ ìŠ¤í‚¬ (.claude/skills/*.md ì°¸ì¡°)

## ğŸ”— ì˜ì¡´ì„± ì •ë³´

**ì˜ì¡´ì„± ì²´ì¸**: P2D1, P3BA1, P3BA2, P3BA11

ì´ ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ ì‘ì—…ì´ ì™„ë£Œë˜ì–´ì•¼ í•©ë‹ˆë‹¤:
- P2D1: Supabase ìŠ¤í‚¤ë§ˆ êµ¬ì¶• (ai_evaluations í…Œì´ë¸”)
- P3BA1: ì¸ì¦ API (ê´€ë¦¬ì ê¶Œí•œ í™•ì¸)
- P3BA2: ì •ì¹˜ì¸ API (ì •ì¹˜ì¸ ë°ì´í„°)
- P3BA11: AI í‰ê°€ ì¡°íšŒ API (ì¡°íšŒ ê¸°ëŠ¥ ì„ í–‰)

---

## ğŸ“¦ ê¸°ëŒ€ ê²°ê³¼ë¬¼

- `src/app/api/evaluations/generate/route.ts` (AI í‰ê°€ ìƒì„± - Mock â†’ Real)
- `src/app/api/evaluations/[evaluationId]/update/route.ts` (í‰ê°€ ìˆ˜ì •)
- `src/app/api/evaluations/batch/route.ts` (ì¼ê´„ í‰ê°€ ìƒì„±)

**êµ¬í˜„í•´ì•¼ í•  ì„¸ë¶€ í•­ëª©**:

1. **Mock ì½”ë“œ ì œê±° ë° Real API êµ¬í˜„**
   - ê¸°ì¡´ Mock ì‘ë‹µ ì œê±°
   - Supabase í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
   - `ai_evaluations` í…Œì´ë¸” INSERT/UPDATE

2. **AI í‰ê°€ ìƒì„± API**
   - ì •ì¹˜ì¸ ID ê¸°ë°˜ í‰ê°€ ìƒì„±
   - AI ëª¨ë¸ ì„ íƒ (Claude, ChatGPT, Gemini, Grok, Perplexity)
   - 10ê°œ í‰ê°€ ê¸°ì¤€ë³„ ì ìˆ˜ ë° ê·¼ê±° ì €ì¥
   - ì¢…í•© ì ìˆ˜ ë° ë“±ê¸‰ ê³„ì‚°

3. **AI í‰ê°€ ìˆ˜ì • API**
   - ê¸°ì¡´ í‰ê°€ ë°ì´í„° ìˆ˜ì •
   - ë¶€ë¶„ ì—…ë°ì´íŠ¸ ì§€ì›
   - ë²„ì „ ê´€ë¦¬ (updated_at)

4. **ì¼ê´„ í‰ê°€ ìƒì„± API**
   - ì—¬ëŸ¬ ì •ì¹˜ì¸ ë™ì‹œ í‰ê°€
   - ë¹„ë™ê¸° ì‘ì—… í
   - ì§„í–‰ ìƒí™© ì¶”ì 

5. **ê´€ë¦¬ì ê¶Œí•œ í™•ì¸**
   - ì¸ì¦ëœ ê´€ë¦¬ìë§Œ í‰ê°€ ìƒì„± ê°€ëŠ¥
   - RLS ì •ì±… ì ìš©

6. **ì—ëŸ¬ ì²˜ë¦¬ ë° ê²€ì¦**
   - ì¤‘ë³µ í‰ê°€ ë°©ì§€ (upsert)
   - ì ìˆ˜ ë²”ìœ„ ê²€ì¦ (0-100)
   - íŠ¸ëœì­ì…˜ ì²˜ë¦¬

---

## ğŸ“ ì‘ì—… ì§€ì‹œì‚¬í•­

### 1. ì¤€ë¹„ ë‹¨ê³„

- í”„ë¡œì íŠ¸ ë£¨íŠ¸: `Developement_Real_PoliticianFinder/1_Frontend`
- Mock API í™•ì¸ (í˜„ì¬ ì—†ì„ ê°€ëŠ¥ì„± ë†’ìŒ)
- DB ìŠ¤í‚¤ë§ˆ í™•ì¸: `0-4_Database/Supabase/migrations/011_create_ai_evaluations_table.sql`
- ì˜ì¡´ì„± ì‘ì—… ì™„ë£Œ í™•ì¸: P2D1, P3BA1, P3BA2, P3BA11

### 2. êµ¬í˜„ ë‹¨ê³„

**2.1 AI í‰ê°€ ìƒì„± API**

```typescript
// src/app/api/evaluations/generate/route.ts
import { createClient } from '@/lib/supabase/server'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  const supabase = createClient()

  // 1. ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  const { data: { user }, error: authError } = await supabase.auth.getUser()
  if (authError || !user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  // 2. ìš”ì²­ ë°ì´í„° íŒŒì‹±
  const body = await request.json()
  const { politician_id, evaluator } = body

  // 3. í‰ê°€ ë°ì´í„° ìƒì„± (Mock ë°ì´í„° - ì‹¤ì œ AI ì—°ë™ì€ P4BA14ì—ì„œ)
  const evaluationData = {
    politician_id,
    evaluator,
    overall_score: 85,
    grade: 'Rose',
    integrity_score: 90,
    expertise_score: 85,
    // ... ë‚˜ë¨¸ì§€ ê¸°ì¤€
    integrity_evidence: 'Mock evidence',
    // ... ë‚˜ë¨¸ì§€ ê·¼ê±°
  }

  // 4. Supabaseì— ì €ì¥ (upsert)
  const { data, error } = await supabase
    .from('ai_evaluations')
    .upsert(evaluationData, {
      onConflict: 'politician_id,evaluator'
    })
    .select()

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ success: true, data })
}
```

**2.2 AI í‰ê°€ ìˆ˜ì • API**

```typescript
// src/app/api/evaluations/[evaluationId]/update/route.ts
export async function PATCH(
  request: NextRequest,
  { params }: { params: { evaluationId: string } }
) {
  // ë¶€ë¶„ ì—…ë°ì´íŠ¸ êµ¬í˜„
}
```

**2.3 ì¼ê´„ í‰ê°€ ìƒì„± API**

```typescript
// src/app/api/evaluations/batch/route.ts
export async function POST(request: NextRequest) {
  // ì—¬ëŸ¬ ì •ì¹˜ì¸ ë™ì‹œ í‰ê°€ ìƒì„±
  // Promise.all ë˜ëŠ” ì‘ì—… í ì‚¬ìš©
}
```

### 3. ê²€ì¦ ë‹¨ê³„

- íƒ€ì… ì²´í¬: `npm run type-check`
- ë¹Œë“œ: `npm run build`
- API í…ŒìŠ¤íŠ¸: Thunder Client ë˜ëŠ” Postman
  - í‰ê°€ ìƒì„± í…ŒìŠ¤íŠ¸
  - ì¤‘ë³µ í‰ê°€ upsert í…ŒìŠ¤íŠ¸
  - ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
- RLS ì •ì±… í™•ì¸

### 4. ì™„ë£Œ ë‹¨ê³„

- ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡ í™•ì¸
- PROJECT GRID ì—…ë°ì´íŠ¸ (ìƒì„±ëœ íŒŒì¼, ì‘ì—… ì‹œê°„, ìƒíƒœ)
- ë‹¤ìŒ ì‘ì—… (P4BA14) ì¤€ë¹„

---

## âœ… ì™„ë£Œ ê¸°ì¤€

- [ ] AI í‰ê°€ ìƒì„± APIê°€ ì‹¤ì œ Supabaseì— ë°ì´í„° ì €ì¥
- [ ] Mock ì½”ë“œ ì œê±° (ë˜ëŠ” ìƒˆë¡œ ìƒì„±)
- [ ] Upsert ê¸°ëŠ¥ ì •ìƒ ì‘ë™ (ì¤‘ë³µ ë°©ì§€)
- [ ] ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ êµ¬í˜„
- [ ] ì ìˆ˜ ë²”ìœ„ ê²€ì¦ (0-100)
- [ ] í‰ê°€ ìˆ˜ì • API êµ¬í˜„
- [ ] ì¼ê´„ í‰ê°€ ìƒì„± API êµ¬í˜„
- [ ] TypeScript íƒ€ì… ì²´í¬ í†µê³¼
- [ ] Next.js ë¹Œë“œ ì„±ê³µ
- [ ] RLS ì •ì±… ì ìš© í™•ì¸
- [ ] íŠ¸ëœì­ì…˜ ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ
- [ ] PROJECT GRID ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ

---

## ğŸ“Š API ìš”ì²­/ì‘ë‹µ ìŠ¤í‚¤ë§ˆ

**ìš”ì²­ (POST /api/evaluations/generate)**:
```json
{
  "politician_id": "uuid",
  "evaluator": "claude" // or 'chatgpt', 'gemini', 'grok', 'perplexity'
}
```

**ì‘ë‹µ**:
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "politician_id": "uuid",
    "evaluator": "claude",
    "overall_score": 85,
    "grade": "Rose",
    "integrity_score": 90,
    "integrity_evidence": "...",
    "created_at": "2025-11-09T...",
    "updated_at": "2025-11-09T..."
  }
}
```

---

## âš ï¸ ì¤‘ìš” ì°¸ê³ ì‚¬í•­

**ì´ ì‘ì—…ì—ì„œëŠ” Mock ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.**

ì‹¤ì œ AI í‰ê°€ ìƒì„± (OpenAI API ì—°ë™)ì€ **P4BA14**ì—ì„œ êµ¬í˜„ë©ë‹ˆë‹¤.

**P3BA12ì˜ ì—­í• **:
- Mock â†’ Real ì „í™˜ (ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™)
- API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- ë°ì´í„° ì €ì¥/ìˆ˜ì • ê¸°ëŠ¥

**P4BA14ì˜ ì—­í• ** (ì¶”í›„):
- OpenAI API í†µí•©
- ì‹¤ì œ AI í‰ê°€ ìƒì„± ë¡œì§
- 30,000ì í‰ê°€ ë¦¬í¬íŠ¸ ìƒì„±

---

**ì‘ì—…ì§€ì‹œì„œ ìƒì„±ì¼**: 2025-11-09
**PROJECT GRID Version**: v4.2
