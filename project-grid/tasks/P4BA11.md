# 작업지시서: P4BA11

## 📋 기본 정보

- **작업 ID**: P4BA11
- **업무명**: 알림 설정 API
- **Phase**: Phase 4
- **Area**: Backend APIs (BA)
- **서브 에이전트**: api-designer
- **작업 방식**: AI-Only

---

## 🎯 작업 목표

전역 알림 설정 및 알림 템플릿을 관리하는 API를 구축합니다.

---

## 🔧 사용 도구

```
[Claude 도구]
Read, Edit, Write, Grep, Glob, Bash

[기술 스택]
TypeScript, Next.js API Routes, Supabase, Zod

[전문 스킬]
api-builder
```

**도구 설명**:
- **Claude 도구**: Claude Code의 기본 기능 (Read, Write, Edit, Bash, Glob, Grep 등)
- **기술 스택**: 프로젝트에 사용되는 프레임워크 및 라이브러리
- **전문 스킬**: Anthropic 빌트인 스킬 (.claude/skills/*.md 참조)

## 🔗 의존성 정보

**의존성 체인**: P2D1

이 작업을 시작하기 전에 다음 작업이 완료되어야 합니다: P2D1 (Database 스키마)

---

## 📦 기대 결과물

- app/api/admin/notification-settings/route.ts
- app/api/admin/notification-templates/route.ts
- lib/notifications/template-engine.ts

**구현해야 할 세부 항목**:

1. **전역 알림 on/off**: 알림 기능 전체 활성화/비활성화
2. **알림 템플릿 관리**: 각 알림 타입별 메시지 템플릿
3. **알림 발송 규칙**: 발송 주기, 배치 처리 등

각 항목을 체계적으로 구현하고 테스트하세요.

---

## 💾 구현 파일 저장 위치

**루트 폴더**: `3_Backend_APIs/`

**파일 경로**:
```
3_Backend_APIs/
├── app/
│   └── api/
│       └── admin/
│           ├── notification-settings/
│           │   └── route.ts
│           └── notification-templates/
│               └── route.ts
└── lib/
    └── notifications/
        └── template-engine.ts
```

**절대 경로 별칭**: `@/` (예: `import ... from '@/lib/notifications/template-engine'`)

---

## 📝 작업 지시사항

### 1. 준비 단계

- 프로젝트 루트 디렉토리에서 작업 시작
- 필요한 도구 확인: TypeScript/Next.js API Routes/Supabase/Zod
- 의존성 작업 완료 확인 (P2D1)

### 2. 구현 단계

**Database 스키마** (P2D1에 추가 필요):
```sql
CREATE TABLE notification_templates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  type VARCHAR(50) NOT NULL UNIQUE,
  title_template TEXT NOT NULL,
  body_template TEXT NOT NULL,
  is_enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 템플릿 예시 (초기 데이터)
INSERT INTO notification_templates (type, title_template, body_template) VALUES
('comment', '{작성자}님이 댓글을 남겼습니다', '{작성자}님이 회원님의 게시글에 댓글을 남겼습니다: "{댓글내용}"'),
('like', '{작성자}님이 공감했습니다', '{작성자}님이 회원님의 게시글을 공감했습니다.'),
('follow', '{작성자}님이 팔로우했습니다', '{작성자}님이 회원님을 팔로우했습니다.'),
('mention', '{작성자}님이 회원님을 언급했습니다', '{작성자}님이 게시글에서 회원님을 언급했습니다.');

CREATE INDEX idx_notification_templates_type ON notification_templates(type);
```

**API Endpoints**:
```typescript
GET /api/admin/notification-settings - 전역 설정 조회
PATCH /api/admin/notification-settings - 전역 설정 수정

GET /api/admin/notification-templates - 템플릿 목록
GET /api/admin/notification-templates/[type] - 템플릿 상세
PATCH /api/admin/notification-templates/[type] - 템플릿 수정
```

**템플릿 변수**:
- {작성자}: 알림을 발생시킨 사용자 이름
- {댓글내용}: 댓글 내용 (첫 50자)
- {게시글제목}: 게시글 제목

### 3. 검증 단계

- 전역 설정 기능 동작
- 템플릿 수정 기능 동작
- 템플릿 엔진 동작 확인

### 4. 완료 단계

- 생성된 파일 목록 확인
- PROJECT GRID 상태 업데이트
- 다음 의존 작업에 영향 확인

---

## ✅ 완료 기준

- [ ] 전역 설정 기능 동작
- [ ] 템플릿 수정 기능 동작
- [ ] 템플릿 엔진 동작 확인
- [ ] 변수 치환 기능 확인
- [ ] 단위 테스트 작성
- [ ] API 테스트 통과

---

**작업지시서 생성일**: 2025-11-06
**PROJECT GRID Version**: v4.0
