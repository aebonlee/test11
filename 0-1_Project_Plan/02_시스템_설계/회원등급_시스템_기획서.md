# 회원 등급 시스템 기획서

**문서 버전**: v1.0
**작성일**: 2025-12-12
**프로젝트**: PoliticianFinder

---

## 1. 개요

PoliticianFinder는 **두 개의 완전히 독립적인 등급 시스템**을 운영합니다.

| 구분 | 활동 등급 | 영향력 등급 |
|------|----------|------------|
| **명칭** | ML1 ~ ML10 | 방랑자 ~ 군주 |
| **기준** | 누적 활동 포인트 | 팔로워 수 + 지역 순위 |
| **획득 방식** | 능동적 (본인이 활동) | 수동적 (타인이 팔로우) |
| **혜택** | 실질적 기능 권한 | 명예/위신만 (기능 없음) |

**핵심 원칙**: 두 시스템은 **서로 다른 로직**으로 동작하며, 섞어서 생각하면 안 됩니다.

---

## 2. 활동 등급 (Activity Level)

### 2.1 개념

- **정의**: 회원이 **직접 활동**하여 획득하는 등급
- **기준**: 누적 활동 포인트
- **특징**: **능동적** 행위로만 포인트 획득
- **혜택**: 레벨에 따른 **실질적 기능 권한** 제공

### 2.2 등급 구조

| 등급 | 필요 포인트 | 설명 |
|------|------------|------|
| ML1 | 0 ~ 99 | 신규 가입 |
| ML2 | 100 ~ 299 | 초보 활동 |
| ML3 | 300 ~ 599 | 기본 활동 |
| ML4 | 600 ~ 999 | 적극 활동 |
| ML5 | 1,000 ~ 1,999 | 중급 회원 |
| ML6 | 2,000 ~ 3,999 | 숙련 회원 |
| ML7 | 4,000 ~ 7,999 | 고급 회원 |
| ML8 | 8,000 ~ 15,999 | 베테랑 |
| ML9 | 16,000 ~ 31,999 | 엘리트 |
| ML10 | 32,000+ | 전설 |

### 2.3 포인트 획득 방법

**본인이 직접 하는 활동만 포인트 획득:**

| 활동 | 포인트 | 비고 |
|------|--------|------|
| 게시글 작성 | +50p | 일일 제한 있음 |
| 댓글 작성 | +10p | 일일 제한 있음 |
| 정치인 평가 | +30p | - |
| 출석 체크 | +5p/일 | 연속 출석 보너스 |
| 게시글 추천받기 | +5p/개 | - |
| 베스트 글 선정 | +100p | - |

### 2.4 등급별 혜택

| 등급 범위 | 기능적 권한 |
|----------|-----------|
| ML1~ML2 | 게시글 1일 3개, 댓글 1일 10개 |
| ML3~ML4 | 게시글 1일 5개, 이미지 첨부 |
| ML5~ML6 | 게시글 무제한, 투표 생성 |
| ML7~ML8 | 예약 발행, 통계 대시보드 |
| ML9~ML10 | 운영 건의 우선권, 베타 접근 |

### 2.5 DB 구조

```sql
-- users 테이블
activity_points INTEGER DEFAULT 0      -- 누적 포인트
activity_level VARCHAR(10) DEFAULT 'ML1'  -- 현재 등급

-- 등급 계산 함수
CREATE FUNCTION calculate_activity_level(p_points INTEGER)
RETURNS VARCHAR(10) AS $$
BEGIN
  IF p_points < 100 THEN RETURN 'ML1';
  ELSIF p_points < 300 THEN RETURN 'ML2';
  -- ... (생략)
  ELSE RETURN 'ML10';
  END IF;
END;
$$
```

---

## 3. 영향력 등급 (Influence Grade)

### 3.1 개념

- **정의**: **다른 사람들이 나를 팔로우**하여 결정되는 등급
- **기준**: 팔로워 수 + 지역구 내 순위
- **특징**: **수동적** 결과 (타인의 행동에 의해 결정)
- **혜택**: **명예/위신만** 제공 (별도 기능 없음)

### 3.2 등급 구조

| 칭호 | 한글명 | 이모지 | 기준 |
|------|--------|--------|------|
| Wanderer | 방랑자 | 🚶 | 팔로워 10명 미만 |
| Knight | 기사 | ⚔️ | 팔로워 10명 이상 |
| Lord | 영주 | 🏰 | 팔로워 50명 이상 + 지역 상위 20% |
| Duke | 공작 | 👑 | 팔로워 200명 이상 + 지역 상위 5% |
| Monarch | 군주 | 🌟 | 팔로워 500명 이상 + 지역 1위 |

### 3.3 등급 결정 로직

**두 가지 조건 모두 충족해야 함:**

1. **팔로워 수 조건** (절대 기준)
2. **지역구 내 순위** (상대 기준)

```
예시:
- 팔로워 100명이라도 지역 상위 30%면 → 기사 (Knight)
- 팔로워 50명이고 지역 상위 15%면 → 영주 (Lord)
```

### 3.4 갱신 시점

- **실시간 갱신**: 팔로우/언팔로우 발생 즉시
- 별도 배치 작업 없음

### 3.5 DB 구조

```sql
-- users 테이블
follower_count INTEGER DEFAULT 0       -- 팔로워 수
following_count INTEGER DEFAULT 0      -- 팔로잉 수
influence_grade VARCHAR(20) DEFAULT 'Wanderer'  -- 영향력 등급
preferred_district VARCHAR(100)        -- 관심 지역구
district_rank INTEGER DEFAULT 0        -- 지역구 내 순위
district_percentile DECIMAL(5,2)       -- 상위 퍼센트

-- 등급 계산 함수
CREATE FUNCTION calculate_influence_grade(p_user_id UUID)
RETURNS TABLE(rank, total, percentile, grade) AS $$
  -- 팔로워 수와 지역 순위로 등급 계산
$$
```

---

## 4. 두 시스템의 차이점 요약

### 4.1 획득 방식 비교

| 항목 | 활동 등급 | 영향력 등급 |
|------|----------|------------|
| **누가 결정?** | 본인 | 타인 |
| **어떻게?** | 직접 활동 | 팔로우 받음 |
| **통제 가능?** | 예 (노력하면 올림) | 아니오 (타인에 의존) |

### 4.2 혜택 비교

| 항목 | 활동 등급 | 영향력 등급 |
|------|----------|------------|
| **기능 권한** | 있음 | 없음 |
| **게시글 제한** | 등급별 상이 | 영향 없음 |
| **명예/위신** | 부가적 | 핵심 목적 |

### 4.3 UI 표시

```
회원명 옆: [닉네임] ML5 🏰영주

- ML5: 활동 등급 (본인이 얼마나 활동했나)
- 🏰영주: 영향력 등급 (다른 사람들이 얼마나 팔로우하나)
```

---

## 5. 구현 현황

### 5.1 완료된 항목

- [x] DB 스키마 (users 테이블 확장)
- [x] follows 테이블
- [x] activity_points_history 테이블
- [x] 활동 등급 계산 함수 (calculate_activity_level)
- [x] 영향력 등급 계산 함수 (calculate_influence_grade)
- [x] 포인트 자동 지급 트리거 (게시글/댓글 작성 시)
- [x] 팔로우 시 팔로워 카운트 자동 업데이트 트리거
- [x] 프론트엔드 팔로우 버튼
- [x] 팔로워/팔로잉 목록 페이지

### 5.2 남은 항목

- [ ] 등급 승급 알림 모달
- [ ] 실시간 WebSocket 연동
- [ ] 팔로워 획득 토스트 알림

---

## 6. 관련 파일

### 6.1 DB 마이그레이션
- `0-4_Database/Supabase/migrations/060_APPLY_NOW.sql`

### 6.2 API
- `1_Frontend/src/app/api/users/[id]/follow/route.ts`
- `1_Frontend/src/app/api/users/[id]/followers/route.ts`
- `1_Frontend/src/app/api/users/[id]/following/route.ts`
- `1_Frontend/src/app/api/users/[id]/stats/route.ts`

### 6.3 프론트엔드
- `1_Frontend/src/components/FollowButton.tsx`
- `1_Frontend/src/app/users/[id]/followers/page.tsx`
- `1_Frontend/src/app/users/[id]/following/page.tsx`
- `1_Frontend/src/app/mypage/page.tsx`

---

**문서 종료**
