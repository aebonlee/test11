# V24.5 Pooling 평가 시스템 - 작업 계획

**작성일**: 2025-12-03
**작성자**: Claude Code
**목적**: 나머지 27명 정치인 Pooling 평가 완료 계획

---

## 📊 현재 상태

### ✅ 완료된 정치인 (3명)
- **오세훈** (62e7b453) - 완료 시간: 116.1분
- **한동훈** (7abadf92) - 완료 시간: 104.7분
- **김동연** (0756ec15) - 완료 시간: 미확인

### 🔄 준비 완료 (1명)
- **송석준** (023139c6) - 스크립트 준비 완료 (`pooling_송석준_TEST.py`)

### ⏳ 남은 정치인 (26명)
총 30명 중 4명 완료/준비, **26명 남음**

---

## 🎯 평가 방법: 2가지 옵션

### 옵션 1: 기존 성공 방법 (안정적, 느림)
**파일**: `pooling_한동훈_FIXED_V2.py` 기반

**특징**:
- ✅ **100% 검증됨** (오세훈, 한동훈 성공)
- ✅ 모든 데이터 평가 (150개)
- ✅ 실패 위험 없음
- ❌ 배치 크기: 10개씩 처리
- ❌ API 호출: 450회 (3 AI × 150개 ÷ 10)
- ❌ **토큰 절감: 0%** (기준)

**예상 소요 시간**:
- 1명당: ~110분 (오세훈 116분, 한동훈 105분 평균)
- 27명: ~49.5시간 (2일 1.5시간)

**장점**: 확실하게 완료됨
**단점**: 시간 오래 걸림, 비용 높음

---

### 옵션 2: 토큰 절감 방법 (시도 필요, 빠름)
**파일**: `pooling_95percent_savings_test.py` (수정 필요)

**특징**:
- ⚠️ **테스트 필요** (아직 성공 못함)
- ✅ Prompt Caching 활용 (90% 절감)
- ✅ 카테고리 통합 (10개 → 1회 평가)
- ✅ 배치 크기: 150개 한번에
- ✅ API 호출: 30회 (3 AI × 10 카테고리)
- ✅ **토큰 절감: 95% 목표**

**해결해야 할 문제들**:
1. ❌ ChatGPT Rate Limit 초과 (38,873 tokens > 10,000 TPM)
2. ❌ Claude 모델 404 오류 (deprecated model)
3. ❌ Grok 'choices' key 오류

**예상 소요 시간** (성공 시):
- 1명당: ~20분 예상 (90% 절감)
- 27명: ~9시간

**장점**: 시간/비용 대폭 절감
**단점**: 테스트 필요, 실패 위험

---

## 📋 작업 단계

### Phase 1: 옵션 선택 (필수)

**질문**: 어떤 방법으로 진행할까요?

1. **옵션 1 선택**: 안정적이지만 느림 (2일 소요)
   - 즉시 실행 가능
   - `pooling_송석준_TEST.py` 실행
   - 이후 26명 순차 실행

2. **옵션 2 선택**: 빠르지만 테스트 필요 (성공 시 9시간)
   - 먼저 송석준으로 테스트
   - 성공하면 나머지 26명 실행
   - 실패하면 옵션 1로 전환

3. **하이브리드**: 병렬 진행
   - 옵션 1로 일부 시작 (안정적)
   - 동시에 옵션 2 테스트 (최적화)
   - 옵션 2 성공하면 전환

---

### Phase 2: 옵션 1 실행 계획

#### 2-1. 송석준 실행
```bash
cd "C:\Development_PoliticianFinder_com\Developement_Real_PoliticianFinder\0-3_AI_Evaluation_Engine"
PYTHONIOENCODING=utf-8 python -u pooling_송석준_TEST.py 2>&1 | tee pooling_송석준_TEST.log &
```

#### 2-2. 스크립트 복제 (26명)
각 정치인별로 스크립트 복사 및 수정:
```python
# 송석준 스크립트 기반으로 복제
cp pooling_송석준_TEST.py pooling_{정치인명}_TEST.py

# 수정 필요 부분 (2곳):
POLITICIAN_ID = "{politician_id}"  # 라인 30
POLITICIAN_NAME = "{정치인명}"      # 라인 31
```

**26명 정치인 목록**:
1. 추미애 (d8fe79e9)
2. 유승민 (c4331d0e)
3. 나경원 (88aaecf2)
4. 금태섭 (de49f056)
5. 정청래 (8cc0b2fa)
6. 정봉주 (a3d0e994)
7. 김문수 (0138c1f4)
8. 박영선 (fd3ed5df)
9. 최민희 (b26e9b9b)
10. 전광훈 (e8e79a95)
11. 이종걸 (1dff3ddf)
12. 이재명 (8b71fa63)
13. 정동영 (34c67e72)
14. 문재인 (d6f026fb)
15. 안철수 (eeefba98)
16. 박주민 (507226bb)
17. 정세균 (02bae405)
18. 김종인 (9b54e07a)
19. 정진석 (01374f3b)
20. 정의화 (48c9bcbe)
21. 하태경 (ef60acc6)
22. 이준석 (0dd9fd4d)
23. 조국 (1fbbb8d0)
24. 윤석열 (bcd01e00)
25. 정운천 (a5e00efc)
26. 정원오 (17270f25)

#### 2-3. 순차 실행
- 한 번에 1명씩 실행 (안정성)
- 또는 병렬 2-3명 실행 (속도)

---

### Phase 3: 옵션 2 테스트 계획 (선택사항)

#### 3-1. 문제 해결 필요

**문제 1: ChatGPT Rate Limit**
- **원인**: 150개 데이터 한번에 전송 (38,873 tokens > 10,000 TPM)
- **해결 방안**:
  - 방법 A: 데이터 50개씩 3번 나눠 전송
  - 방법 B: GPT-4 Turbo 사용 (더 높은 TPM)
  - 방법 C: Batch API 사용 (50% 할인 + 높은 TPM)

**문제 2: Claude 모델 404**
- **원인**: `claude-3-5-sonnet-20241022` 모델 deprecated
- **해결**: `claude-3-5-haiku-20241022` 사용 (이미 적용됨)

**문제 3: Grok 'choices' 오류**
- **원인**: 응답 구조 변경 가능성
- **해결**: 에러 핸들링 강화, 재시도 로직

#### 3-2. 수정된 스크립트 테스트

**파일**: `pooling_95percent_savings_FIXED.py` (새로 작성)

**주요 수정**:
```python
# 1. 데이터 50개씩 나눔 (ChatGPT Rate Limit 회피)
BATCH_SIZE_FOR_CHATGPT = 50
BATCH_SIZE_FOR_OTHERS = 150

# 2. Claude 모델 변경
model="claude-3-5-haiku-20241022"

# 3. Grok 에러 핸들링
try:
    result = data['choices'][0]['message']['content']
except (KeyError, IndexError) as e:
    # 재시도 로직
```

#### 3-3. 송석준 테스트 실행
```bash
python pooling_95percent_savings_FIXED.py
```

#### 3-4. 성공 시 전체 적용
- 26명에 대해 토큰 절감 방법 사용
- 소요 시간: ~9시간
- 비용 절감: 95%

---

## 💰 비용 비교

### 옵션 1: 기존 방법
- API 호출: 27명 × 450회 = 12,150회
- 예상 비용: ~$XXX (토큰 사용량 기준)

### 옵션 2: 토큰 절감 방법 (성공 시)
- API 호출: 27명 × 30회 = 810회
- 예상 비용: ~$XX (95% 절감)
- **절감액**: ~$XXX

---

## ⏰ 소요 시간 비교

| 방법 | 1명당 시간 | 27명 총 시간 | 비고 |
|------|----------|-------------|-----|
| 옵션 1 (기존) | ~110분 | ~49.5시간 (2일) | 검증됨 |
| 옵션 2 (절감) | ~20분 (예상) | ~9시간 | 테스트 필요 |

---

## 🚀 추천 실행 계획

### Plan A: 안정적 (추천)
1. **즉시 시작**: 옵션 1로 송석준 실행
2. **병렬 테스트**: 옵션 2 수정 및 테스트
3. **조건부 전환**: 옵션 2 성공하면 나머지는 옵션 2 사용

### Plan B: 빠른 시도
1. **옵션 2 우선**: 송석준으로 토큰 절감 방법 테스트
2. **성공 시**: 26명 전부 옵션 2 사용
3. **실패 시**: 전부 옵션 1로 진행

### Plan C: 보수적
1. **전부 옵션 1**: 27명 모두 기존 방법 사용
2. **확실한 완료**: 2일 내 전체 완료
3. **추후 최적화**: 다음 프로젝트에서 옵션 2 활용

---

## 📝 다음 세션 시작 시

### 즉시 확인할 것
1. **Inbox 확인**: 새 작업 지시 있는지
2. **Background 프로세스**: 실행 중인 평가 확인
3. **완료 현황**: 몇 명 완료되었는지

### 실행 명령어
```bash
# Inbox 확인
ls Web_ClaudeCode_Bridge/inbox/*.json

# Background 프로세스 확인
jobs

# 로그 확인 (송석준)
tail -f pooling_송석준_TEST.log
```

---

## ✅ 결론

**즉시 결정 필요**:
- [ ] **옵션 1** 선택 (안정적, 2일)
- [ ] **옵션 2** 선택 (빠름, 테스트 필요)
- [ ] **Plan A** 선택 (병렬 진행)

**현재 준비 완료**:
- ✅ 송석준 스크립트 준비됨 (`pooling_송석준_TEST.py`)
- ✅ 30명 정치인 명단 확보
- ✅ 기존 성공 방법 검증됨

**다음 단계**:
1. 방법 선택
2. 송석준 실행
3. 결과 확인 후 나머지 26명 진행

---

**문의사항**:
- 어떤 옵션으로 진행할까요?
- 병렬 실행 (동시에 여러 명) 원하시나요?
- 토큰 절감 테스트를 먼저 해볼까요?
