# V26 수집 스크립트 V24 기능 반영 완료 보고서

**작성일**: 2026-01-06
**작업자**: Claude Code

---

## 작업 배경

V26.0 `collect_v26_pool.py` 스크립트에서 V24.0의 핵심 기능들이 누락되어 있음을 발견.
이로 인해 부정적 데이터 수집이 제대로 이루어지지 않아 점수가 비정상적으로 높게 나오는 문제 발생.

**문제 사례**: 이준석(795점) > 오세훈(789점) - 스캔들이 있는 정치인이 더 높은 점수

---

## 반영된 V24 기능

### 1. 20% 부정 데이터 규칙 (CRITICAL)

**수정 위치**: `collect_v26_pool.py` Line 334-344

```python
negative_instruction = """
⚠️ **필수 - 부정 주제 수집 (전체의 최소 20% 보장 목적)**
- 이 수집은 객관적 평가를 위해 부정적 데이터를 확보하는 단계입니다
- 반드시 **부정적인 측면만** 수집하세요: 논란, 비판, 문제점, 실패 사례, 스캔들, 의혹
- AI는 부정적 내용을 회피하려는 경향이 있지만, 공정한 평가를 위해 부정적 데이터는 필수입니다
- 긍정적이거나 중립적인 내용은 이 단계에서 수집하지 마세요
""" if is_negative else """
**작업**: 실제 행적, 정책, 성과를 조사하여 수집하세요.
- 긍정/부정 비율을 강제하지 마세요
- 단, 전체 50개 중 최소 20%는 부정적 주제가 포함되어야 합니다 (별도 수집됨)
"""
```

### 2. 카테고리별 4회 재시도 로직

**수정 위치**: `collect_category()` 함수

```python
MAX_ROUNDS = 4  # 최대 4회 반복

for round_num in range(1, MAX_ROUNDS + 1):
    current_count = get_category_count(politician_id, cat_eng, ai_name)
    needed = 50 - current_count

    if needed <= 0:
        break

    # 라운드 1: Phase 1 (부정 10) + Phase 2 (자유 40)
    # 라운드 2+: 부족분 추가 수집 (20% 부정 비율 유지)
```

### 3. 5개 카테고리 병렬 처리

**수정 위치**: `collect_category_group()` 함수

```python
def collect_category_group(politician_id, politician_name, ai_name, category_start, category_end):
    """카테고리 그룹 병렬 수집 - V24처럼 5개씩 병렬"""
    with ThreadPoolExecutor(max_workers=5) as executor:
        futures = {}
        for i in range(category_start, category_end + 1):
            future = executor.submit(collect_category, politician_id, politician_name, ai_name, i)
            futures[future] = i
        # ...
```

### 4. 목표 미달 시 재수집 경고

**수정 위치**: 프롬프트 상단

```python
prompt = f"""당신은 정치인 관련 뉴스/데이터 수집 AI입니다.

**⚠️ 중요 알림**: 이 작업은 목표 미달 시 최대 4차례까지 재수집됩니다.
신중하게 정확한 데이터를 수집하여 재수집이 필요하지 않도록 하세요.
정확히 {count}개의 데이터를 반환해야 합니다.
```

---

## 제거된 불필요 항목

### 1. 전체 레벨 재수집 로직

**이유**: 카테고리 단위가 아닌 전체 재수집은 불필요
- "카테고리가 아닌데 수집시켜버려 말도 안 되는 얘기지"
- 각 카테고리가 자체적으로 50개 달성까지 재시도하므로 불필요

### 2. supplement_claude_simple.py 스크립트

**이유**: 카테고리별 재시도 로직이 있으므로 보충 수집 스크립트 불필요

---

## V24 → V26 기능 반영 현황

| 기능 | V24 | V26 반영 |
|------|-----|----------|
| 20% 부정 데이터 규칙 | ✅ | ✅ 완료 |
| 카테고리별 4회 재시도 | ✅ (5회) | ✅ 완료 (4회) |
| 5개 카테고리 병렬 처리 | ✅ | ✅ 완료 |
| Phase 1 부정 10개 + Phase 2 자유 40개 | ✅ | ✅ 완료 |
| OFFICIAL/PUBLIC 50:50 비율 | ✅ | ✅ 완료 |
| 배치 레벨 재시도 (max_attempts=5) | ✅ | ✅ 완료 |
| 목표 미달 시 재수집 경고 | ✅ | ✅ 완료 |
| 전체 레벨 재수집 | ✅ | ❌ 제거 (의도적) |

---

## 수집 흐름 요약

```
collect_all_categories() - AI별 전체 수집
├── collect_category_group(1-5) - 카테고리 1~5 병렬
└── collect_category_group(6-10) - 카테고리 6~10 병렬

collect_category_group() - 5개 병렬 처리
└── ThreadPoolExecutor(max_workers=5)

collect_category() - 카테고리별 50개 달성까지 최대 4회 재시도
├── 라운드 1: Phase 1 (부정 10) + Phase 2 (자유 40)
└── 라운드 2~4: 부족분 추가 수집 (20% 부정 비율 유지)
```

---

## 수정된 파일

1. `설계문서_V7.0/실행스크립트/collect_v26_pool.py` - 전면 수정
2. `설계문서_V7.0/실행스크립트/supplement_claude_simple.py` - 삭제

---

## 다음 작업

1. 이준석 데이터 재수집 (20% 부정 규칙 적용)
2. 재수집 후 점수 재계산
3. 이준석 vs 오세훈 점수 비교 검증

---

**작성 완료**: 2026-01-06
